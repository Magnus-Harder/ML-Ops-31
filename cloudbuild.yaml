steps:
    - name: python
      entrypoint: bash
      args: ['-c', 'mkdir ML-Ops-31; cd ML-Ops-31; pip install -U dvc dvc[gs];git init; dvc pull;']

    # Step 1: Build the Docker image
    - name: "gcr.io/cloud-builders/docker"
      args:
          [
              "build",
              "-f",
              "./dockerfiles/train_model_cloudbuild.dockerfile",
              ".",
              "-t",
              "gcr.io/dtu-ml-ops-31/trainer:latest"
          ]
      secretEnv: ["WANDB_API_KEY"]

    # Step 2: Push the Docker image to Artifact Registry
    - name: "gcr.io/cloud-builders/docker"
      args: ["push", "gcr.io/dtu-ml-ops-31/trainer:latest"]

# Secrets
availableSecrets:
    secretManager:
        - versionName: projects/1025735580781/secrets/WandbAPI/versions/1
          env : 'WANDB_API_KEY'


images:
    - "gcr.io/dtu-ml-ops-31/trainer:latest"


    
